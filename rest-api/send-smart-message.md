---
id: send-smart-message
title: وب سرویس ارسال پیام هوشمند از سمت سرور
layout: rest-api
permalink: rest-api/send-smart-message.html
---

شما می‌توانید با فراخوانی این وب‌ سرویس، **پیام هوشمند** را به سرور چابک ارسال کنید.

<Br>

### POST | لینک پایه (Path) 

لینک پایه ارسال رویداد**post** `https://{APP_ID}.push.adpdigital.com/api/push/notifyToUsers`
است.


<Br>

### مثال ارسال پیام هوشمند به سرور چابک از طریق شناسه در چابک 


```java
{
  "user": "userId",
  "content": "MESSAGE TEXT",
  "ttl": 60,
  "fallback": {
    "content": "SMS Content",
    "delay": 60,
    "media": "sms",
    "policy": "NOTIFICATION_SHOWN"
  },
  "notification": {
    "title": "title",
    "body": "body"
  }
}
```

-  ``user`` (اجباری)

شناسه کاربری که پیام هوشمند را دریافت می‌کند.

>`نکته`: اگر کاربر با یک دستگاه وارد اپلیکیشن شما شده باشد، پیام هوشمند به آن دستگاه ارسال می‌شود اما اگر کاربر با چندین دستگاه وارد اپلیکیشن شود، پیام هوشمند به تمام دستگاه‌ها ارسال می‌شود.


- ``content`` (اجباری)

محتوای اصلی پیام را به عنوان مقدار **content** ارسال کنید،

>`نکته`: **content** زمانی به کاربران نمایش داده می‌شود که محتوای اس‌ام‌اس و نوتیفیکیشن خالی باشند در غیر این صورت از این محتوا استفاده نمی‌شود. 

- `ttl` (اجباری)

زمانی که کمپینی را ارسال می‌کنید باید انقضای پیام را به عنوان مقدار **ttl** و بر اساس ثانیه ارسال کنید.

>`مثال`: فرض کنید قصد دارید کمپینی به کاربران‌تان ارسال کنید و بعد از ۶۰ ثنیه، کمپین را متوقف کنید، در این صورت باید تاریخ انقضای کمپین را بر روی ۶۰ ثانیه قرار دهید. 


fallback (اجباری)

  - `content`(اختیاری)
 
متن پیام اس‌ام‌اس را به عنوان مقدار **content** ارسال کنید، 
 
 >`نکته`: در صورت مشخص‌ کردن محتوا اس‌ام‌اس و نبود نوتیفیکیشن، پیام به طور خودکار از طریق اس‌ام‌اس به کاربر ارسال می‌شود. 
 
   -  `delay`(اجباری)
   
مدت زمان تاخیر ارسال پیام به عنوان مقدار **delay** است و باید زمان تاخیر را بر اساس ثانیه ارسال کنید. 
  
به عنوان مثال در صورتی که ۶۰ ثانیه از زمان ارسال پیام گذششته باشد و نوتیفیکیشن در این زمان به کاربر ارسال نشده باشد، اس‌ام‌‌اس به کاربر به طور خودکار ارسال می‌شود. 
  
  -  `media`(اجباری)
  
 نوع کمپین ارسال شده به کاربر باید از نوع اس‌ام‌اس یا ایمیل باشد.
  
  -  `policy`(اجباری)
  
سیاست ارسال پیام در فال‌بک بر روی نوتیفیکیشن قرار دارد،
  
`notification`

  - `title`(اجباری)
  
عنوان نوتیفیکیشن به شکل مقدار **title** ارسال می‌شود.

  - `body`(اختیاری)
 
بدنه نوتیفیکیشن به عنوان مقدار **body** ارسال می‌شود. 
  
>`نکته`: اولویت ارسال کمپین به کاربران از طریق نوتیفیکیشن است. در صورت وجود مشکل در ارسال نوتیفیکیشن،، پیام به طور خودکار از طریق اس‌ام‌اس به کاربران ارسال می‌شود. 
  
### دسترسی به شماره تلفن کاربران برای ارسال کمپین 

اگر به دلیل مشکلی از طریق نوتیکیفیکیشن  پیامی به کاربران ارسال نشود، پیام به طور خودکار از طریق اس‌ام‌اس  به کاربر ارسال می‌شود. برای ارسال اس‌ام‌اس نیاز به شماره تلفن کاربران دارید که به یکی از دو روش زیر می‌توانید به آن دسترسی پیدا کنید.

۱. دسترسی به شماره تلفن از طریق اطلاعات کاربر

شماره تلفن کاربر از طریق بخش اطلاعات کاربران (user attribute) قابل مشاهده است، البته در صورتی که در بخش اطلاعات کاربران، شماره تلفن را به عنوان **phone** سیو کرده باشید.

در غیر این صورت:

۲. اگر کاربر **userID** خود را با شماره تلفن سیو کرده باشد.

در قسمت **userID** شماره تلفن کاربر با پسوند پیش‌فرض ۹۸ نمایش داده می‌شود.

>`نکته`: در صورتی که کاربر در قسمت **phone بخش اطلاعات کاربر**، شماره تلفنی سیو  کرده باشد و **userID** خودش را هم با شماره تلفن ذخیره کره باشد، (حتی اگر شماره تلفن‌ها متفاوت باشد)، پیام به شماره تلفنی ارسال می‌شود که از بخش اطلاعات کاربر، ذخیره شده است. 

>`نکته`: برای ارسال ایمیل هم اولویت با آدرس ایمیلی است که در اطلاعات کاربر وجود دارد نه **userID**.
